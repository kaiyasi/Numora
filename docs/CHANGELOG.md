# 更新日誌

所有重要的專案變更都會記錄在此檔案中。

格式基於 [Keep a Changelog](https://keepachangelog.com/zh-TW/1.0.0/)，
並且此專案遵循 [語義化版本](https://semver.org/lang/zh-TW/)。

## [未發布]

### 計劃中
- 更多政府資料來源整合
- 進階資料視覺化功能

## [3.0.0] - 2025-10-19

### 🎉 重大更新

#### 🌐 政府開放資料整合
- **YouBike 即時資訊**：台北市/新北市 YouBike 2.0 即時車輛數據
  - 支援城市與行政區篩選
  - 每頁 10 筆資料顯示
  - 全形字符統一格式
  - 站點名稱智能處理（括號轉全形空格）
  - 依站點名稱長度升冪排序
  - Select Menu 導航系統（上一頁/下一頁/返回選項）
- **圖書館座位資訊**：台北市立圖書館即時座位查詢
  - 分館篩選功能
  - 使用率顏色標示（綠/黃/紅）
  - 即時可用座位顯示
- **自行車竊盜統計**：台北市自行車竊盜案件資料
  - 案件類型、時間、地點完整資訊
  - 民國年自動轉換西元年
  - 分頁瀏覽功能

#### 📊 Web 介面增強
- **新增圖書館座位頁面**：`/library`
  - 分館下拉選單
  - 座位統計表格
  - 使用率視覺化
- **新增自行車竊盜頁面**：`/bike_theft`
  - 案件列表顯示
  - 日期格式轉換
  - 分頁導航
- **首頁更新**：整合所有政府資料查詢入口
- **Logo 系統**：品牌視覺識別完整應用
  - 導航列 Logo 顯示
  - Favicon 設置

#### 🤖 Discord Bot 功能強化
- **資料提交系統**：
  - `/submit_api`：API 提交功能（含 Modal 表單）
    - Discord ID/Email 收集
    - API URL 與資料格式說明
    - 回傳資料描述與範例
    - 自動發送至審核頻道
  - `/submit_csv`：公開 CSV 提交
    - 資料集名稱與描述
    - 資料來源記錄
    - 5 分鐘上傳窗口
    - 自動資料分析
  - `/upload_csv`：個人即時分析
    - 單次使用，不儲存
    - 即時統計分析
    - Ephemeral 私人回應

#### 🔧 技術架構改進
- **API 端點優化**：
  - `/api/library/seats` - 圖書館座位資料 API
  - `/api/library/branches` - 分館列表 API
  - `/api/bike_theft/data` - 竊盜案件資料 API
- **錯誤處理增強**：
  - 政府 API 回應驗證
  - Content-Type 異常處理
  - HTTP 標頭格式檢查
  - 使用者友善錯誤訊息
- **資料處理優化**：
  - JSON 手動解析支援
  - 編碼檢測改進
  - 全形/半形字符轉換
  - 字串寬度計算優化

### 改進
- ⚡ **效能提升**：非同步 API 呼叫優化
- 🎨 **UI/UX 改善**：
  - YouBike 顯示格式統一
  - 站點名稱對齊優化
  - 全形字符一致性
  - Select Menu 導航體驗
- 📱 **響應式設計**：Bootstrap 5 完整應用
- 🔍 **資料查詢**：政府資料 API 智能重試機制
- 📝 **日誌系統**：詳細的 API 呼叫追蹤

### 修復
- 🐛 修復 WiFi 熱點資料查詢失敗問題
- 🐛 修復圖書館 API Content-Type 錯誤
- 🐛 修復水質 API HTTP 標頭格式問題
- 🐛 修復觀光統計 API 403 錯誤
- 🐛 修復 YouBike 站點名稱對齊問題
- 🐛 修復括號導致的長度不一致問題
- 🐛 修復 Discord 互動逾時錯誤
- 🐛 修復文件權限錯誤

### 移除
- ❌ 移除不穩定的政府資料來源（WiFi 熱點、水質、觀光統計）
- ❌ 移除冗餘的開發啟動腳本

### 安全性
- 🔐 提交功能頻道權限控制
- 🔐 CSV 上傳檔案驗證
- 🔐 API URL 格式驗證
- 🔐 使用者輸入清理

### 文檔更新
- 📚 完整的 V3.0.0 功能說明
- 📚 政府資料 API 使用指南
- 📚 資料提交流程文檔
- 📚 開發環境設置更新

### 相容性說明
- ✅ 完全向後相容 V2.0.0 的核心功能
- ✅ Discord 指令保持一致
- ⚠️ 部分政府資料來源 API 已移除（不穩定）
- ⚠️ 環境變數無需更改

### 升級指南

#### 從 v2.0.0 升級到 v3.0.0

**新增功能：**
1. 政府開放資料整合功能
2. 資料提交系統
3. Web 介面新頁面

**升級步驟：**
```bash
# 1. 拉取最新代碼
git pull origin main

# 2. 重新安裝依賴（如有新增）
pip install -r requirements.txt

# 3. 重啟服務
docker compose down
docker compose up -d --build
```

**無須變更：**
- 環境變數設定
- Discord Bot Token
- 現有資料和設定

## [2.0.0] - 2024-01-15

### 新增
- 🏗️ **重大重構**：完全模組化的程式碼架構
- 🤖 **機器學習預測**：使用 scikit-learn 進行犯罪趨勢預測
- 🔔 **即時通知系統**：支援多種通知類型和訂閱管理
- 🌐 **Web 介面**：基於 Flask 的互動式儀表板
- 📊 **進階圖表**：使用 Plotly 的互動式圖表
- 🧪 **完整測試框架**：使用 pytest 的單元測試
- 📚 **完善文檔**：包含 API 文檔和開發者指南
- 🚀 **CI/CD 管道**：GitHub Actions 自動化測試和部署
- 🐳 **Docker 支援**：容器化部署配置
- 🔒 **安全增強**：輸入驗證、錯誤處理、日誌管理

### 改進
- ⚡ **效能優化**：資料處理速度提升 300%
- 🎨 **UI/UX 改善**：更直觀的 Discord 互動介面
- 📈 **圖表品質**：更高解析度和更好的中文字型支援
- 🛡️ **錯誤處理**：更完善的異常處理和使用者友好的錯誤訊息
- 📝 **日誌系統**：結構化日誌和自動日誌輪轉

### 修復
- 🐛 修復中文編碼問題
- 🐛 修復記憶體洩漏問題
- 🐛 修復圖表生成時的暫存檔案清理
- 🐛 修復地區解析的邊界情況

### 安全性
- 🔐 加強檔案上傳驗證
- 🔐 改善敏感資料處理
- 🔐 添加速率限制保護

## [1.2.0] - 2023-12-01

### 新增
- ✨ 全年度統計圖表功能
- 📱 改善的行動裝置支援
- 🔍 更智能的地區識別演算法

### 改進
- 🚀 圖表載入速度提升 50%
- 💾 減少記憶體使用量
- 🎯 更準確的地區匹配

### 修復
- 🐛 修復特定地區名稱的解析問題
- 🐛 修復年份選擇器的顯示問題

## [1.1.0] - 2023-11-15

### 新增
- 🏆 地區排名統計功能
- 📊 可選擇排名數量（前5/10/15/20名）
- 🎨 新的圖表顏色主題

### 改進
- 📈 圖表解析度提升
- 🔧 程式碼結構優化

### 修復
- 🐛 修復 CSV 檔案編碼檢測問題
- 🐛 修復時段統計的顯示錯誤

## [1.0.1] - 2023-11-01

### 修復
- 🐛 修復檔案上傳大小限制問題
- 🐛 修復部分地區名稱無法識別的問題
- 📝 修正 README 中的安裝說明

### 安全性
- 🔒 加強檔案類型驗證

## [1.0.0] - 2023-10-15

### 新增
- 🎉 **首次發布**
- 📤 CSV 檔案上傳功能
- 📊 基本統計圖表生成
- 🗺️ 地區智能識別
- 📈 年度趨勢分析
- 🎯 互動式選單介面
- 🇹🇼 完整繁體中文支援

### 功能特色
- **多格式支援**：自動檢測 UTF-8、Big5、CP950 等編碼
- **智能欄位映射**：自動識別日期、地點、案類等欄位
- **精確地址解析**：支援市、縣、區、鄉、鎮等不同層級
- **中文字型支援**：完美顯示繁體中文圖表
- **即時圖表生成**：選擇變更時即時更新

### Discord 指令
- `/upload` - 上傳 CSV 檔案
- `/summary` - 顯示統計總覽
- `/rank` - 地區排名統計
- `/stats` - 詳細統計資料
- `/clear` - 清除上傳資料

## 版本說明

### 版本編號規則
我們使用 [語義化版本](https://semver.org/lang/zh-TW/) 格式：`主版本.次版本.修訂版本`

- **主版本**：不相容的 API 變更
- **次版本**：向後相容的功能新增
- **修訂版本**：向後相容的問題修復

### 變更類型

- `新增` - 新功能
- `改進` - 現有功能的改善
- `修復` - 錯誤修復
- `移除` - 移除的功能
- `安全性` - 安全性修復
- `棄用` - 即將移除的功能

### 支援政策

- **最新主版本**：完整支援，包含新功能和錯誤修復
- **前一個主版本**：僅提供安全性修復，持續 6 個月
- **更舊版本**：不再支援

### 升級指南

#### 從 v1.x 升級到 v2.0

**重大變更：**
1. 程式碼架構完全重構，主程式檔案從 `main.py` 變更為 `bot.py`
2. 新增多個環境變數配置選項
3. Web 介面為新功能，需要額外設定

**升級步驟：**
1. 備份現有資料和設定
2. 更新依賴：`pip install -r requirements.txt`
3. 複製環境變數：`cp env.example .env` 並填入設定
4. 使用新的啟動方式：`python bot.py`

**向後相容性：**
- 原有的 Discord 指令完全相容
- CSV 檔案格式保持不變
- 圖表功能向後相容

### 即將推出

查看我們的 [專案路線圖](https://github.com/your-username/crime-statistics-discord-bot/projects) 了解即將推出的功能。

### 貢獻

歡迎貢獻！請查看我們的 [貢獻指南](CONTRIBUTING.md) 了解如何參與開發。

---

**完整變更歷史**：[GitHub Releases](https://github.com/your-username/crime-statistics-discord-bot/releases)
